<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–µ—Å—Ç–µ—Ä–∏—è: –¢–µ—Å—Ç –°–∏—Å—Ç–µ–º</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body { background: #1a202c; color: #e2e8f0; font-family: sans-serif; }
        #debug-console {
            background: #000;
            color: #0f0;
            padding: 15px;
            margin: 20px;
            border-radius: 8px;
            font-family: monospace;
            height: 400px;
            overflow-y: auto;
            border: 1px solid #333;
        }
        .err { color: #ff4444; }
        .ok { color: #44ff44; }
        .warn { color: #ffaa00; }
        .loading { animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="p-5">
    <h1 class="text-2xl font-bold mb-4">üõ† –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –¥–≤–∏–∂–∫–∞ ¬´–í–µ—Å—Ç–µ—Ä–∏—è¬ª</h1>
    <p class="mb-2">–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç, –ø–æ—á–µ–º—É –∏–≥—Ä–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Vercel.</p>
    
    <div id="debug-console">
        <div>[SYSTEM] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–∞...</div>
    </div>

    <div class="mt-4 flex gap-4">
        <button onclick="location.reload()" class="bg-blue-600 px-4 py-2 rounded">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ</button>
        <a href="https://vercel.com/dashboard" target="_blank" class="bg-gray-700 px-4 py-2 rounded">–í –ø–∞–Ω–µ–ª—å Vercel</a>
    </div>
</div>

<script>
    const log = document.getElementById('debug-console');
    
    function print(text, type = '') {
        const div = document.createElement('div');
        div.className = type;
        div.innerHTML = `[${new Date().toLocaleTimeString()}] ${text}`;
        log.appendChild(div);
        log.scrollTop = log.scrollHeight;
    }

    async function runDiagnostic() {
        print("--- –°–¢–ê–†–¢ –ü–û–õ–ù–û–ô –ü–†–û–í–ï–†–ö–ò ---");

        // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
        print("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–µ–¥—ã –∑–∞–ø—É—Å–∫–∞...");
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            print("‚ö† –í—ã –∑–∞–ø—É—â–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ. API –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.", "warn");
        } else {
            print(`‚úÖ –°–∞–π—Ç –∑–∞–ø—É—â–µ–Ω –Ω–∞ –¥–æ–º–µ–Ω–µ: ${window.location.hostname}`, "ok");
        }

        // 2. –¢–µ—Å—Ç JavaScript-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ (–∫–∞–≤—ã—á–∫–∏ Word)
        print("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ (–ø–æ–∏—Å–∫ '–∫—Ä–∏–≤—ã—Ö' –∫–∞–≤—ã—á–µ–∫ Word)...");
        try {
            const testStr = "–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞"; 
            const testObj = { key: "value" };
            print("‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å JS –≤ –ø–æ—Ä—è–¥–∫–µ. –í—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑ Word –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ.", "ok");
        } catch (e) {
            print("‚ùå –û–®–ò–ë–ö–ê –°–ò–ù–¢–ê–ö–°–ò–°–ê! –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –≤ –∫–æ–¥–µ –µ—Å—Ç—å –∫–∞–≤—ã—á–∫–∏-–µ–ª–æ—á–∫–∏ ¬´¬ª –∏–ª–∏ –Ω–∞–∫–ª–æ–Ω–Ω—ã–µ ‚Äú‚Äù.", "err");
        }

        // 3. –¢–µ—Å—Ç JSON-–ø–∞—Ä—Å–µ—Ä–∞ (—Ç–≤–æ—è –≥–ª–∞–≤–Ω–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞)
        print("–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ JSON-–æ—Ç–≤–µ—Ç–∞ –æ—Ç –Ω–µ–π—Ä–æ—Å–µ—Ç–∏...");
        const mockResponse = `{"narrative": {"text": "–¢–µ—Å—Ç"}, "playerUpdate": {"hp": 100}}`;
        try {
            const parsed = JSON.parse(mockResponse);
            if (parsed.narrative.text === "–¢–µ—Å—Ç") {
                print("‚úÖ –ú–µ—Ö–∞–Ω–∏–∫–∞ —Ä–∞–∑–±–æ—Ä–∞ JSON —Ä–∞–±–æ—Ç–∞–µ—Ç –∏—Å–ø—Ä–∞–≤–Ω–æ.", "ok");
            }
        } catch (e) {
            print("‚ùå –û–®–ò–ë–ö–ê JSON: –°–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏.", "err");
        }

        // 4. –ì–õ–ê–í–ù–´–ô –¢–ï–°–¢: –°–≤—è–∑—å —Å API –Ω–µ–π—Ä–æ—Å–µ—Ç–∏
        print("üì° –ü–æ–ø—ã—Ç–∫–∞ —Å–≤—è–∑–∞—Ç—å—Å—è —Å API (–Ω–µ–π—Ä–æ—Å–µ—Ç—å—é)...", "loading");
        try {
            // –ü—ã—Ç–∞–µ–º—Å—è –≤—ã–∑–≤–∞—Ç—å —Ç–≤–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
            const response = await fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    messages: [{ role: "user", content: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç" }]
                })
            });

            if (response.ok) {
                print("üéâ –£–°–ü–ï–•! –¢–≤–æ–π API (/api/chat) —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –æ—Ç–≤–µ—á–∞–µ—Ç.", "ok");
                const data = await response.json();
                print("–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω: " + JSON.stringify(data).substring(0, 50) + "...", "ok");
            } else {
                print(`‚ùå –û–®–ò–ë–ö–ê API: –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –∫–æ–¥ ${response.status}`, "err");
                
                if (response.status === 404) {
                    print("üëâ –ü—Ä–∏—á–∏–Ω–∞: Vercel –Ω–µ –≤–∏–¥–∏—Ç –ø–∞–ø–∫—É /api/. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ GitHub –µ—Å—Ç—å –ø–∞–ø–∫–∞ 'api' —Å —Ñ–∞–π–ª–æ–º 'chat.js'.", "warn");
                } else if (response.status === 405) {
                    print("üëâ –ü—Ä–∏—á–∏–Ω–∞: –ú–µ—Ç–æ–¥ POST –∑–∞–ø—Ä–µ—â–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞.", "warn");
                } else if (response.status === 500) {
                    print("üëâ –ü—Ä–∏—á–∏–Ω–∞: –û—à–∏–±–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞. –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, —Ç–≤–æ–π API_KEY –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∏–ª–∏ –Ω–µ –ø—Ä–æ–ø–∏—Å–∞–Ω –≤ Environment Variables.", "warn");
                }
            }
        } catch (e) {
            print("‚ùå –°–ï–¢–ï–í–ê–Ø –û–®–ò–ë–ö–ê: –ó–∞–ø—Ä–æ—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.", "err");
            print("–ï—Å–ª–∏ —Ç—ã –Ω–∞ Vercel, —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –ø—É—Ç—å /api/chat –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.", "err");
        }

        print("--- –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê ---");
        print("–ï—Å–ª–∏ –≤—Å–µ –ø—É–Ω–∫—Ç—ã ‚úÖ, –Ω–æ –∏–≥—Ä–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ª–æ–≥–∏–∫–µ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.");
    }

    // –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
    window.onload = () => setTimeout(runDiagnostic, 1000);
</script>

</body>
</html>
